var swipeEnd;var rotationInterval;var redrawCanvas;var img;var DragImage;var dataError;var dTap=false;var resetTap;var disableTouch=false;var requestSent=false;var context="";if($("#myCanvas").length>0){context=$("#myCanvas").get(0).getContext("2d")}var checkDeposit={accountData:{},scale:1,translatePos:{x:1,y:1},scaleMultiplier:0.5,startDragOffset:{},mouseDown:false,touch:false,zoomType:"zoomin",imgsrc:"",totalCount:0,selectedData:{},index:0,currView:"frontImage",queryObject:{},intialLoad:true,firstTouch:0,canvasWidth:0,canvasHeight:0,zoomDisabled:true,toggleDisabled:true,nextDisabled:true,prevDisabled:true,imageLoading:false,beyondCanvas:false,checkCanvasState:false,cDep:"",myImageCanvas:"",canvasImg:"",init:function(){cDep=this;myImageCanvas=$("#myCanvas");canvasImg=$("#canvasImage");cDep.zoomDisabled=true;var f=$("#sliderContainer");var d=f.find("#zoom");var e=f.find("#prev");var b=f.find("#next");var a=f.find("#rotate");var c=f.find("#done");d.attr("title","Zoom In");a.attr("class","toggleDisabled");d.attr("class","zoomDisabled");a.css("cursor","default");d.css("cursor","default");e.attr("class","prevDisabled");b.attr("class","nextDisabled");b.css("cursor","default");e.css("cursor","default");$("#loadingImg").show();$("html.no-canvas #accountActivityContainer").on("click","li a",function(g){g.preventDefault();return false});$("html.canvas #accountActivityContainer").on("click","li a",function(g){g.preventDefault();checkDeposit.openSlider(g,this)});b.off("click").on("click",function(g){disableTouch=true;if(requestsent){return false}cDep.navNext();g.preventDefault()});e.off("click").on("click",function(g){disableTouch=true;if(requestsent){return false}cDep.navPrev();g.preventDefault()});a.off("click").on("click",function(g){if(cDep.toggleDisabled==true){return false}myImageCanvas.attr("width",myImageCanvas.attr("width"));$("#loadingImg").show();canvasImg.removeClass("gradientBG").addClass("animateCanvas");if(cDep.currView=="frontImage"){cDep.currView="backImage"}else{cDep.currView="frontImage"}var h=setTimeout(function(){if(cDep.zoomType=="zoomout"){cDep.handleZoom(true)}else{cDep.canvasDraw(null,cDep.currImageObj,cDep.currView)}canvasImg.addClass("gradientBG").removeClass("animateCanvas")},1000);g.preventDefault()});d.off("click").on("click",function(g){cDep.handleZoom(true);g.preventDefault()});myImageCanvas.bind("dblclick",function(g){cDep.handleZoom(true);g.preventDefault()});c.off("click").on("click",function(j){var k=$("#sliderContainer");var h=k.find("#zoom");var g=k.find("#rotate");myImageCanvas.attr("width",myImageCanvas.attr("width"));var i=setTimeout(function(){$("#sliderContainer").addClass("slideContainerDown")},0);$("#overlay").show();$("#sliderContainer").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$("#sliderContainer").hide();$("#sliderContainer").removeClass("slideContainerDown");$("#dateinfo").text("");$("#amountInfo").text("");$("#meta").text("");$(".viewType h2").text("");$(".pagination").text("");$("#pageHeader").text(" ");$("#pageHeader").html("&nbsp");$("#overlay").hide();$("#sliderContainer").off("webkitAnimationEnd oanimationend msAnimationEnd animationend");$(window).scrollTop(currPosition)});cDep.accountData={};cDep.scale=1;cDep.translatePos={x:1,y:1};$(".error").text("");cDep.scaleMultiplier=0.5;cDep.startDragOffset={};cDep.mouseDown=false;cDep.touch=false;cDep.imgsrc="";cDep.intialLoad=true;cDep.totalCount=0;cDep.selectedData={};cDep.index=0;cDep.currView="frontImage";cDep.firstTouch=0;cDep.nextDisabled=true;cDep.prevDisabled=true;cDep.toggleDisabled=true;cDep.imageLoading=false;disableTouch=false;requestsent=false;if(cDep.zoomType=="zoomout"){cDep.zoomType="zoomin";cDep.zoomDisabled=false;cDep.scale=1}h.attr("title","Zoom In");g.attr("class","toggleDisabled");h.attr("class","zoomDisabled");g.css("cursor","default");h.css("cursor","default");$("#main-container").show();$("#global-header").show();$("#global-nav").show();$("#global-footer").show();j.preventDefault()});cDep.canvasListeners()},openSlider:function(c,b){$(".error").hide();$("#loadingImg").show();$("#overlay").show();$("#sliderContainer").appendTo("body");$("#overlay").appendTo("body");currPosition=$(window).scrollTop();$(window).scrollTop(0);$("#sliderContainer").show();var a=setTimeout(function(){$("#sliderContainer").addClass("slideContainerUp")},0);var d=setTimeout(function(){$("#main-container").hide();$("#global-header").hide();$("#global-nav").hide();$("#global-footer").hide();$("#sliderContainer").removeClass("slideContainerUp");$("#overlay").hide()},1000);var e=$(b).attr("href").split("?");checkImageAJAX.calldataAJAX(e[1]);c.preventDefault()},handleZoom:function(b){var c=$("#sliderContainer");var a=c.find("#zoom");if(cDep.zoomDisabled){return false}myImageCanvas.attr("width",myImageCanvas.attr("width"));if(cDep.zoomType==""||cDep.zoomType=="zoomin"){cDep.zoomType="zoomout";scale/=cDep.scaleMultiplier;cDep.translatePos.x=1;cDep.translatePos.y=1;if(b){a.attr("class","zoomminusEnabled");a.attr("title","Zoom Out");cDep.canvasDraw(scale,cDep.currImageObj,cDep.currView)}}else{cDep.zoomType="zoomin";scale*=cDep.scaleMultiplier;if(b){a.attr("class","zoomplusEnabled");a.attr("title","Zoom In");cDep.canvasDraw(scale,cDep.currImageObj,cDep.currView)}}},loadData:function(b){cDep.totalCount=b.length;for(var a in b){if((b[a].itemSequenceNumber==cDep.queryObject.isn)&&(b[a].filteredDate==cDep.queryObject.date)){currindex=b[a].index;break}else{currindex=0}}cDep.index=b[currindex].index;cDep.setNavimages();cDep.selectedData=b;cDep.populateData(b[currindex],"frontImage")},populateData:function(a,b){$("#loadingImg").show();if(!cDep.intialLoad){if(swipeEnd!=undefined){clearTimeout(swipeEnd)}swipeEnd=setTimeout(function(){requestsent=true;cDep.imageLoading=false;checkImageAJAX.imageAJAX(a,b)},1500)}else{cDep.intialLoad=false;cDep.imageLoading=false;checkImageAJAX.imageAJAX(a,b)}$("#dateinfo").text(a.filteredDate);$("#amountInfo").text(a.formattedAmount);var e=$("#sliderContainer");var c=e.find("#meta");var d=e.find("#pageHeader");if(cDep.queryObject.key=="1"&&cDep.queryObject.isRI=="false"){d.text("Deposit");if(a.itemType==undefined){c.text(a.description)}else{c.text(a.itemType)}}else{if(cDep.queryObject.key=="2"&&cDep.queryObject.isRI=="false"){d.text("Check");c.text(a.description)}else{if(cDep.queryObject.isRI=="true"){d.text("Returned Item");c.text(a.returnReason)}}}},setNavimages:function(){var b=$("#prev");var a=$("#next");if(cDep.index==0){b.attr("class","prevDisabled");b.css("cursor","default");cDep.prevDisabled=true}else{b.attr("class","prevEnabled");b.css("cursor","pointer");cDep.prevDisabled=false}if(cDep.index==cDep.totalCount-1){a.attr("class","nextDisabled");a.css("cursor","default");cDep.nextDisabled=true}else{a.attr("class","nextEnabled");a.css("cursor","pointer");cDep.nextDisabled=false}cDep.setPagination()},setPagination:function(){$(".pagination").html(checkDeposit.index+1+" of "+cDep.totalCount)},canvasDraw:function(f,e,b){var d=$("#sliderContainer");var c=d.find("#zoom");var a=d.find("#rotate");if(b=="frontImage"){$(".viewType h2").text("Front View");a.attr("title","Back View")}else{$(".viewType h2").text("Back View");a.attr("title","Front View")}$("#loadingImg").hide();myImageCanvas.attr("width",myImageCanvas.attr("width"));if(e[0].errorCode==null||e[0].errorCode=="ImageFrontNotFound"||e[0].errorCode=="ImageBackNotFound"){if((b=="frontImage"&&e[0].errorCode=="ImageFrontNotFound")||(b=="backImage"&&e[0].errorCode=="ImageBackNotFound")){cDep.imageError(e[0].message,true,true,false)}else{imgDrag=new DragImage(f,"data:image/png;base64,"+e[0][b],1,1);imgDrag.update();if(cDep.zoomType=="zoomout"){c.attr("class","zoomminusEnabled");c.attr("title","Zoom Out")}else{c.attr("class","zoomplusEnabled");c.attr("title","Zoom In")}a.attr("class","toggleEnabled");a.css("cursor","");cDep.toggleDisabled=false;cDep.zoomDisabled=false;c.css("cursor","")}}else{if(e[0].errorCode=="SYSTEM_NOT_AVAILABLE"){$(".error").show();$(".error").html(e[0].message);cDep.imageError("This image could not be displayed.",true,false,false)}else{if(e[0].errorCode=="NoImageforCash"||e[0].errorCode=="NoImageforLessCash"){cDep.imageError(e[0].message,false,false,true)}else{cDep.imageError(e[0].message,true,false,false)}}}},imageError:function(i,d,e,f){var h=$("#sliderContainer");var a=h.find("#zoom");var g=h.find("#rotate");disableTouch=true;if(d){context.lineWidth=2;context.fillStyle="#E0E3E2";context.lineStyle="#000";cDep.translatePos.x=(Math.round(myImageCanvas.width()/2))-(cDep.imageWidth/4);cDep.translatePos.y=1;context.fillRect(cDep.translatePos.x+10,cDep.translatePos.y+10,(cDep.imageWidth/2)-20,myImageCanvas.height()-20)}context.font="13px Arial";context.fillStyle="#000";if(f){var b=new Image();var c=(myImageCanvas.attr("width")/2-context.measureText(i).width/2+16);b.onload=function(){requestsent=false;context.drawImage(b,c-20,(myImageCanvas.attr("height")/2)-13)};b.src="../resources/css/images/icn_info_16x16.png";context.fillText(i,c,myImageCanvas.attr("height")/2)}else{requestsent=false;var c=(myImageCanvas.attr("width")/2-context.measureText(i).width/2);context.fillText(i,c,myImageCanvas.attr("height")/2)}cDep.imageLoading=true;a.attr("title","Zoom In");a.attr("class","zoomDisabled");cDep.zoomDisabled=true;a.css("cursor","default");if(!e){g.attr("class","toggleDisabled");g.css("cursor","default");cDep.toggleDisabled=true}else{g.attr("class","toggleEnabled");g.css("cursor","");cDep.toggleDisabled=false}},navPrev:function(){var e=$("#sliderContainer");var b=e.find("#zoom");var a=e.find("#rotate");var c=e.find(".error");if(cDep.index==0||cDep.prevDisabled==true){return false}b.attr("title","Zoom In");b.attr("class","zoomDisabled");a.attr("class","toggleDisabled");b.css("cursor","default");a.css("cursor","default");c.text("");c.hide();cDep.toggleDisabled=true;cDep.currView="frontImage";myImageCanvas.attr("width",myImageCanvas.attr("width"));checkDeposit.index=cDep.index-1;var d=cDep.selectedData[cDep.index];cDep.setNavimages();if(cDep.zoomType=="zoomout"){b.attr("title","Zoom In");cDep.handleZoom(false);cDep.zoomDisabled=true;cDep.populateData(d,"frontImage")}else{cDep.populateData(d,"frontImage")}},navNext:function(){var e=$("#sliderContainer");var b=e.find("#zoom");var a=e.find("#rotate");var c=e.find(".error");if(cDep.index==cDep.totalCount-1||cDep.nextDisabled==true){return false}b.attr("class","zoomDisabled");b.attr("title","Zoom In");a.attr("class","toggleDisabled");b.css("cursor","default");a.css("cursor","default");c.html("");c.hide();cDep.toggleDisabled=true;cDep.currView="frontImage";myImageCanvas.attr("width",myImageCanvas.attr("width"));cDep.index=cDep.index+1;var d=cDep.selectedData[cDep.index];cDep.setNavimages();if(cDep.zoomType=="zoomout"){b.attr("title","Zoom In");cDep.handleZoom(false);cDep.zoomDisabled=true;cDep.populateData(d,"frontImage")}else{cDep.populateData(d,"frontImage")}},handleDataError:function(){var f=$("#sliderContainer");var c=f.find("#zoom");var e=f.find("#prev");var b=f.find("#next");var a=f.find("#rotate");c.attr("class","zoomDisabled");c.attr("title","Zoom In");a.attr("class","toggleDisabled");a.css("cursor","default");c.css("cursor","default");e.attr("class","prevDisabled");b.attr("class","nextDisabled");b.css("cursor","default");e.css("cursor","default");if(!!$(".error").html()){$(".error").show()}$("#dateinfo").text("");$("#amountInfo").text("");$("#meta").text("");$("#loadingImg").hide();$(".viewType h2").text("");$(".pagination").text("");var d=f.find("#pageHeader");if(cDep.queryObject.key=="1"&&cDep.queryObject.isRI=="false"){d.text("Deposit")}else{if(cDep.queryObject.key=="2"&&cDep.queryObject.isRI=="false"){d.text("Check")}else{if(cDep.queryObject.isRI=="true"){d.text("Returned Item")}}}myImageCanvas.attr("width",myImageCanvas.width());myImageCanvas.attr("height",myImageCanvas.height());cDep.imageError("This image could not be displayed.",true,false,false)},resetCanvas:function(){if(!cDep.imageLoading){if(rotationInterval!=undefined){clearTimeout(rotationInterval)}rotationInterval=setTimeout(function(){cDep.resetCanvas()},1000);return false}myImageCanvas.attr("width",myImageCanvas.width());myImageCanvas.attr("height",myImageCanvas.height());scale=0.5;if(cDep.zoomType==""||cDep.zoomType=="zoomout"){scale/=cDep.scaleMultiplier;cDep.translatePos.x=1;cDep.translatePos.y=1}cDep.canvasDraw(scale,cDep.currImageObj,cDep.currView)},canvasListeners:function(){canvas.addEventListener("mousedown",function(d){if(cDep.zoomType=="zoomin"){return false}cDep.checkCanvasState=false;cDep.mouseDown=true;cDep.startDragOffset.x=d.clientX-cDep.translatePos.x;cDep.startDragOffset.y=d.clientY-cDep.translatePos.y});canvas.addEventListener("mouseup",function(d){if(cDep.zoomType=="zoomin"){return false}cDep.mouseDown=false;cDep.checkCanvasState=true;imgDrag.update()});canvas.addEventListener("mouseover",function(d){cDep.mouseDown=false});canvas.addEventListener("mouseout",function(d){if(cDep.zoomType=="zoomin"){return false}cDep.mouseDown=false;cDep.checkCanvasState=true;imgDrag.update()});canvas.addEventListener("mousemove",function(d){if(cDep.zoomType=="zoomin"||cDep.mouseDown==false){return false}cDep.translatePos.x=d.clientX-cDep.startDragOffset.x;cDep.translatePos.y=d.clientY-cDep.startDragOffset.y;imgDrag.update()});canvas.addEventListener("touchstart",function(d){if(requestsent||dTap||disableTouch){return false}if(cDep.firstTouch==0){cDep.firstTouch=cDep.firstTouch+1;d1=new Date();var e=setTimeout(function(){cDep.firstTouch=0;dTap=false},501)}else{if(cDep.firstTouch==1){d2=new Date();cDep.firstTouch=0;if(parseInt(d2.getTime()-d1.getTime())<500){dTap=true;cDep.handleZoom(true);if(resetTap!=undefined){clearTimeout(resetTap)}resetTap=setTimeout(function(){cDep.firstTouch=0;dTap=false},600)}return false}}cDep.checkCanvasState=false;cDep.touch=true;cDep.startDragOffset.x=d.targetTouches[0].pageX-cDep.translatePos.x;cDep.startDragOffset.y=d.targetTouches[0].pageY-cDep.translatePos.y});canvas.addEventListener("touchleave",function(d){if(cDep.zoomType=="zoomin"||dTap==true||requestsent||disableTouch){return false}cDep.touch=false;cDep.checkCanvasState=true;imgDrag.update()});canvas.addEventListener("touchend",function(d){if(cDep.zoomType=="zoomin"||dTap==true||requestsent||disableTouch){return false}cDep.touch=false;cDep.checkCanvasState=true;imgDrag.update()});canvas.addEventListener("touchcancel",function(d){cDep.touch=false});canvas.addEventListener("touchmove",function(d){cDep.firstTouch=0;if(cDep.zoomType=="zoomin"||dTap==true||requestsent||disableTouch){return false}cDep.touch=true;cDep.translatePos.x=d.targetTouches[0].pageX-cDep.startDragOffset.x;cDep.translatePos.y=d.targetTouches[0].pageY-cDep.startDragOffset.y;imgDrag.update();d.preventDefault()});var c=$("#canvas");c.bind("swipeleft",function(d){disableTouch=true;cDep.firstTouch=0;if(cDep.zoomType=="zoomout"||cDep.index==cDep.totalCount-1||requestsent){return false}cDep.navNext()});c.bind("swiperight",function(d){disableTouch=true;cDep.firstTouch=0;if(cDep.zoomType=="zoomout"||cDep.index==0||requestsent){return false}cDep.navPrev()});var a="onorientationchange" in window,b=a?"orientationchange":"resize";window.addEventListener(b,function(){context.clearRect(0,0,3000,3000);$("#loadingImg").show();if(redrawCanvas!=undefined){clearTimeout(redrawCanvas)}redrawCanvas==setTimeout(function(){if(!dataError){cDep.resetCanvas()}else{cDep.handleDataError()}},1000)},false)}};var checkImageAJAX={scale:1,calldataAJAX:function(e){var d=$("#sliderContainer");var b=d.find("#myCanvas");var c=d.find("#canvasImage");if(window.orientation!=undefined){if(window.orientation==0){checkDeposit.imageWidth=Math.round((b.width()*2)-30);checkDeposit.imageHeight=Math.round(b.height())}else{if(window.orientation==90||window.orientation==-90){var a=navigator.userAgent.toLowerCase().indexOf("iphone");if(a>-1){calcWidth=320}else{calcWidth=$(window).height()}checkDeposit.imageWidth=Math.round((calcWidth*2)-30);checkDeposit.imageHeight=Math.round(b.height())}}}else{checkDeposit.imageWidth=Math.round((b.width()*2)-30);checkDeposit.imageHeight=Math.round(b.height())}$.ajax({type:"post",url:"/mba/accounts/ImageMetaData.action?"+e,success:function(h,f,k){if(h.indexOf("sign on")==-1&&h.indexOf("Sign On")==-1){var j=e.split("&");for(var g=0;g<j.length;g++){checkDeposit.queryObject[j[g].split("=")[0]]=j[g].split("=")[1]}if(h[0].errorCode=="SYSTEM_NOT_AVAILABLE"||checkDeposit.queryObject.isn==""||checkDeposit.queryObject.date==""||checkDeposit.queryObject.isn=="null"||checkDeposit.queryObject.date=="null"){$(".error").html(h[0].message);checkDeposit.handleDataError();dataError=true}else{dataError=false;checkDeposit.loadData(h)}}else{location.href="/mba/common/expired.action"}},failure:function(f){location.href="/mba/common/expired.action"},dataFilter:function(g,f){return g.substring(14,g.length-14)}})},imageAJAX:function(a,b){var e=$("#sliderContainer");var c=e.find("#myCanvas");var d=e.find("#canvasImage");c.attr("width",c.width());c.attr("height",c.height());$.ajax({type:"post",url:"/mba/accounts/ImageView.action?key="+checkDeposit.queryObject.key+"&index="+a.index+"&isRI="+checkDeposit.queryObject.isRI+"&imageWidth="+checkDeposit.imageWidth,success:function(f){if(f.indexOf("sign on")==-1&&f.indexOf("Sign On")==-1){checkDeposit.currImageObj=f;if(checkDeposit.imageLoading==false){scale=0.5}checkDeposit.canvasDraw(scale,checkDeposit.currImageObj,b)}else{location.href="/mba/common/expired.action"}},failure:function(f){location.href="/mba/common/expired.action"},dataFilter:function(g,f){return g.substring(14,g.length-14)}})}};function DragImage(g,f,a,h){var c=this;this.img=new Image();this.img.src=f;var e=$("#sliderContainer");var b=e.find("#myCanvas");var d=e.find("#canvasImage");this.update=function(){if(checkDeposit.zoomType=="zoomout"){if(((checkDeposit.translatePos.x+(c.img.width))<=30)||(checkDeposit.translatePos.x>((b.width())-30))){checkDeposit.beyondCanvas=true}if(((checkDeposit.translatePos.y+(c.img.height))<=30)||(checkDeposit.translatePos.y>((b.height)-30))){checkDeposit.beyondCanvas=true}if(checkDeposit.checkCanvasState==true&&checkDeposit.beyondCanvas==true){checkDeposit.beyondCanvas=false;checkDeposit.translatePos.x=1;checkDeposit.translatePos.y=1}}draw(g,checkDeposit.translatePos,c.img)}}function draw(g,e,f){var d=$("#sliderContainer");var a=d.find("#myCanvas");var b=d.find("#canvasImage");if((!checkDeposit.mouseDown||!checkDeposit.touch)||dTap==true){var c=new Image();c.src=f.src;c.onload=function(){disableTouch=false;requestsent=false;if(checkDeposit.zoomType!="zoomout"){if(window.orientation!=undefined){if(window.orientation==0){e.x=Math.round(a.width()/2-(checkDeposit.imageWidth/4)+10);e.y=Math.round(a.height()/2-(c.height/4)+30)}else{if(window.orientation==90||window.orientation==-90){e.x=Math.round(a.width()/2-(checkDeposit.imageWidth/4)+125);e.y=Math.round(a.height()/2-(c.height/4)+10)}}}else{e.x=Math.round(a.width()/2-(checkDeposit.imageWidth/4));e.y=Math.round(a.height()/2-(c.height/4)+10)}}checkDeposit.imageLoading=true;a.attr("width",a.attr("width"));if(g!=null){context.scale(g,g)}else{context.scale(0.5,0.5)}context.drawImage(c,e.x,e.y)}}else{disableTouch=false;checkDeposit.imageLoading=true;requestsent=false;a.attr("width",a.attr("width"));if(g!=null){context.scale(g,g)}else{context.scale(0.5,0.5)}context.drawImage(f,e.x,e.y)}};